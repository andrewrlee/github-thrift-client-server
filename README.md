# github-thrift-client-server

This project currently consists of 3 clojure projects:

 - api     
 - feeder
 - server

The api project builds the library jar which contains classes generated by thrift. This is shared by both the client and the server. The feeder application pulls information about "push" events from github and then sends them via thrift to a server. The test server implementation in server/testserve.clj just stores the received push events in memory.  

The feed traversal has been implemented as a lazy sequence of single events which transparently loads additional pages of events as required. 

## Installation

### API

First, build the api project:

1.) Download [thrift](http://thrift.apache.org/) tarball:
   * `./configure` ensuring that java support is enabled (depends on java 1.7+ and ant).
   * `make && make install`

2.) Ensure the `thrift` executable is available on the path.

3.) run `lein jar` to generate the class files from thrift definitions.

4.) run `lein install` to install the library in the local maven repo.

This will make the library available to other projects.

### Server

To build the server jar:

```
cd server
lein uberjar
```

Launch the server: `java -jar server-0.1.0-SNAPSHOT-standalone.jar`

|Default host and port: ||
|-----|---------| 
|HOST |localhost|
|PORT |8080     |

The location of the server can be overriden:

`HOST=127.0.0.1 PORT=9000 java -jar server-0.1.0-SNAPSHOT-standalone.jar`

### Client

To build the client jar 

```
cd feeder
lein uberjar
```

Get an api token from [github](https://github.com/blog/1509-personal-api-tokens)

To run the feeder: `GITHUB_TOKEN="<TOKEN>" java -jar feeder-0.1.0-SNAPSHOT-standalone.jar`

This will attempt to push the latest events to the server.

The location of the server can be overriden:

`HOST=127.0.0.1 PORT=9000 GITHUB_TOKEN=<TOKEN> java -jar feeder-0.1.0-SNAPSHOT-standalone.jar`

## Usage

In a terminal:

```
$ java -jar server-0.1.0-SNAPSHOT-standalone.jar 
INFO > Mon Feb 23 19:26:19 GMT 2015 > System started, bind-host:localhost, port:8080
```

In another terminal:

```
$ GITHUB_TOKEN="<GITHUB-API-TOKEN>" java -jar feeder-0.1.0-SNAPSHOT-standalone.jar 
INFO > Mon Feb 23 19:28:02 GMT 2015 > connecting on ["localhost" 8080]
INFO > Mon Feb 23 19:28:02 GMT 2015 > Healthy!
INFO > Mon Feb 23 19:28:02 GMT 2015 > connecting on ["localhost" 8080]
requesting: https://api.github.com/events
requesting: https://api.github.com/events?page=2
requesting: https://api.github.com/events?page=3
requesting: https://api.github.com/events?page=4
requesting: https://api.github.com/events?page=5
requesting: https://api.github.com/events?page=6
requesting: https://api.github.com/events?page=7
requesting: https://api.github.com/events?page=8
requesting: https://api.github.com/events?page=9
requesting: https://api.github.com/events?page=10
finished pushing batch
```

##TODO

* Implement daemon style functionality in the feeder - polling at a set interval.
* Use logback or some clj logging framework 
* Proper error handling
* Add server written in a different language.
* Better namespace names
* Tests!

## License

Copyright Â© 2015 AL

Distributed under the Eclipse Public License either version 1.0 or (at
your option) any later version.
